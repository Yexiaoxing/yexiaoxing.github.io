<!DOCTYPE html>
<html lang="">



<!-- Head tag -->
<head>
    
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no">
    
    <title>
    
        Deploy Mailman 3 on AWS Using Docker (In Progress) - 
    
    Xiaoxing Ye&#39;s Farmland
    </title>
    
    <meta name="keywords" content="">
    <meta name="description" content="">
    <meta name="author" content="Xiaoxing Ye">
    
    
    <link rel="alternate" type="application/atom+xml" href="/atom.xml">
    
    
    
    
    <link href="/css/style.css" rel="stylesheet" type="text/css">
    <link href="https://cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    
    <script src="https://cdn.bootcss.com/jquery/3.1.1/jquery.min.js"></script>
    <!--<script src="https://cdn.bootcss.com/jquery_lazyload/1.9.7/jquery.lazyload.min.js"></script>-->
    
    
    <script src="/js/script.js" type="text/javascript" async></script>
    
    <!-- Global javascript config object -->
    <script type="text/javascript">
    var CONFIG = {
    
    
    };
    </script>
    
    
    
    <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        showProcessingMessages: false,
        jax: ["input/TeX","output/HTML-CSS", "output/PreviewHTML"], 
        extensions: ["tex2jax.js", "fast-preview.js", "AssistiveMML.js" /*"MathMenu.js", "MathZoom.js", "[Contrib]/a11y/accessibility-menu.js"*/ ],
        TeX: {
            extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
        }, 
        tex2jax: {
            inlineMath: [['$','$']],
            displayMath: [['$$','$$']], 
            processEscapes: true,
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        },
        "HTML-CSS": {linebreaks: {automatic: true}},
        SVG: {linebreaks: {automatic: true}}
    });
    </script>
    <script type="text/javascript" src="https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js" async></script><!-- hexo-inject:begin --><!-- hexo-inject:end -->
    
    
    

    
    
    

    

</head>


<body class="post">
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><nav id="header">
    <div class="container clearfix">
        <div class="logo" style="width: auto;">
            <a href="/" title="Xiaoxing Ye&#39;s Farmland" rel="home" style="text-decoration: none;">
                
                <span class="brand-logo">
                    
                    Xiaoxing Ye&#39;s Farmland
                    
                
                </span>
            </a>
        </div>
        <div id="global-nav">
            <ul class="gnul">
                <li class="gnli ">
                    <a class="gna fa fa-home" href="/" title="Xiaoxing Ye&#39;s Farmland">
                        <span class="gn-item">Home</span>
                    </a>
                </li>
                
                <li class="gnli dropdown current">
                    <a class="gna fa fa-bars" href="#">
                        <span class="gn-item">Navigation</span>
                    </a>
                    <div class="submenu">
                        <div class="tab-content">
                            <table>
                                <tbody>
                                    
                                    <tr class="trline">
                                        <td class="tdleft">Categories</td>
                                        <td class="tdright">
                                            <ul class="tab-categories">
                                            
                                                <li class="cat-item">
                                                    <a href="/categories/Tutorials/">Tutorials</a>
                                                </li>
                                            
                                            </ul>
                                        </td>
                                    </tr>
                                    
                                    <tr>
                                        <td class="tdleft">Tags</td>
                                        <td class="tdright">
                                            <div class="tab-tags">
                                                <a href="/tags/Tutorials/" style="font-size: 12px;">Tutorials</a> <a href="/tags/docker/" style="font-size: 12px;">docker</a> <a href="/tags/mailman/" style="font-size: 12px;">mailman</a> <a href="/tags/aws/" style="font-size: 12px;">aws</a> <a href="/tags/Installation/" style="font-size: 12px;">Installation</a> <a href="/tags/Hexo/" style="font-size: 12px;">Hexo</a>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </li>
                
                
                <li class="gnli">
                    <a class="gna fa fa-archive" href="/archives/index.html" title="">
                        <span class="gn-item">Archive</span>
                    </a>
                </li>
                
                <li class="gnli">
                    <a class="gna fa fa-user" href="/about/index.html" title="">
                        <span class="gn-item">About Me</span>
                    </a>
                </li>
                
                
                
            </ul>
        </div>
        

    </div>
</nav>

    
<main id="content">
    <div class="container clearfix">
        <div id="primary" >
            <nav class="breadcrumb-navigation">
                <a rel="bookmark" href="/">Home</a>
                <span class="breadcrumb-arrow fa fa-angle-right"></span>
                 
Uncategorized

                <span class="breadcrumb-arrow fa fa-angle-right"></span>
                Deploy Mailman 3 on AWS Using Docker (In Progress)
            </nav>
            <article class="single-post">
                <header class="post-header">
                    <h1 class="post-title">
                        <a href="/2017/11/24/Deploy-Mailman-3-on-AWS-using-Docker/" title="Deploy Mailman 3 on AWS Using Docker (In Progress)">Deploy Mailman 3 on AWS Using Docker (In Progress)</a>
                    </h1>
                </header>
                <div class="post-meta">
    <ul class="inline-ul">
        <li class="inline-li">
            <time>2017-11-24</time>
        </li>
        
        
    </ul>
</div> 

                <div class="post-body clearfix">
                    <div class="post-content">
                        
                        <p>Docker is now a hot topic, which is an open platform for developers and sysadmins to build, ship, and run distributed applications. It is good if you want to isolate different app environments.</p>
<p>Another topic today, Mailman, is a free software for managiing mailing list. It is a GNU project and it offers a good interface. In this article, I would like to introduce how to use Docker to deploy Mailman 3 on AWS, with Postfix and Amazon SES.</p>
<p>In this tutorial, I will assume that you are using macOS or Linux, which has an embedded OpenSSH tool. If you are using Windows 10, you may use the Windows Subsystem for Linux. For more information on the subsystem, please refer to <a href="https://msdn.microsoft.com/en-us/commandline/wsl/install-win10" target="_blank" rel="noopener">MSDN - Windows 10 Installation Guide</a> .</p>
<h1>Initialize a new EC2 Instance</h1>
<p>Before we go into the EC2 part, there remains a question — why not Elastic Container Service? One simple answer is, we need to deploy images on one instance (to save resource). So, let's get started.</p>
<h2>Generate a SSH Key</h2>
<p>First you need a SSH keys. By default, Amazon EC2 instances only allow user to log in using Key-Based Authentication. SSH keys provide an easy and secure way of logging into your server with only a pair of public/private keys.</p>
<p>If you don't have one, you may create one on your computer.</p>
<ol>
<li>Run the command (replace the your_email@example.com with your main email address).</li>
</ol>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa -b 4096 -C <span class="string">"your_email@example.com"</span></span><br></pre></td></tr></table></figure></p>
<ol start="2">
<li>When you're prompted to &quot;Enter a file in which to save the key,&quot; press Enter. This accepts the default file location. Or you may choose your desired file location.</li>
<li>When you're prompted to &quot;Enter passphrase (empty for no passphrase)&quot;, please enter one password you like. You need to remember the password since it is required to decrypt the secret key. You may leave it blank, though it will be a bit unsecure.</li>
</ol>
<p><img src="https://static.notion-static.com/e0d490aea5114b298e1c48833f84c244/Untitled" alt=""></p>
<h2>Add the New SSH Key to <code>ssh-agent</code></h2>
<p><code>ssh-agent</code> is a program to hold private keys used for public key authentication (RSA, DSA). You may need to add your newly-generated key to <code>ssh-agent</code> , to make sure it will be used later. Here are the steps:</p>
<ol>
<li>Start a new agent process in the background.</li>
</ol>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">eval</span> <span class="string">"<span class="variable">$(ssh-agent -s)</span>"</span></span><br></pre></td></tr></table></figure></p>
<ol start="2">
<li>(For macOS Sierra / High Sierra users) You will need to modify your ~/.ssh/config file to automatically load keys into the ssh-agent and store passphrases in your keychain.</li>
</ol>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Host *</span><br><span class="line"> AddKeysToAgent yes</span><br><span class="line"> UseKeychain yes</span><br><span class="line"> IdentityFile ~/.ssh/id_rsa</span><br></pre></td></tr></table></figure></p>
<ol start="3">
<li>Add your key to agent. Remember to replace ~/.ssh/id_rsa with where you place it.</li>
</ol>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-add -K ~/.ssh/id_rsa</span><br></pre></td></tr></table></figure></p>
<p><img src="https://static.notion-static.com/24f9896a829e4949b945c650f5448939/Untitled" alt=""></p>
<h2>Import the SSH Key on Amazon Platform</h2>
<p>Now you have your owned SSH keys, and you will need to import it so Amazon can recognize it.</p>
<p>Log into your <a href="https://console.aws.amazon.com/console/home" target="_blank" rel="noopener">AWS Console</a> , click the EC2 link to go to the <a href="https://console.aws.amazon.com/ec2/v2/home" target="_blank" rel="noopener">EC2 Console</a> . Here you need to choose one of the available regions of EC2. Since I live in China, I choose the <em>Asia Pacific (Tokyo)</em> region for better speed. You may choose based on your visitor origins.</p>
<p><img src="https://static.notion-static.com/34f50a4985ab47a5a93913ab9e1acf14/Untitled" alt=""></p>
<p>Click Network &amp; Security - Key Pairs on left sidebar. You will see a &quot;Import Key Pair&quot; button on top. Here you may copy using <code>clipcopy</code> by</p>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat &lt;where_is_your_public_key.pub&gt; | clipcopy</span><br></pre></td></tr></table></figure></p>
<p>You will need to paste it in the popup window on AWS console.</p>
<h2>Launch a New Instance</h2>
<p>After you have imported the public key, go back to the Dashboard page. Then click the big blue button &quot; <em>Launch Instance</em> &quot;.</p>
<p><img src="https://static.notion-static.com/0145cbc2e7624bbabcd4f28fbaac5835/Untitled" alt=""></p>
<p>On the next page, you should choose an Amazon Machine Image (AMI) to run on the new EC2 Instance. An AMI is a template that contains the software configuration (operating system, application server, and applications) required to launch your instance. Here we will pick the Amazon Linux AMI, since it includes most we need.</p>
<p><img src="https://static.notion-static.com/d20cdf36ad294eafaf395b20eb86b6e8/Untitled" alt=""></p>
<p>Next, choose an Instance Type, which is a combination of CPU, memory, storage, and networking capacity. Here we choose the <code>t2.micro</code> which provides free tier, then click on the &quot;Next: Configure Instance Details&quot; button. <a href="https://aws.amazon.com/free/" target="_blank" rel="noopener">Learn more</a> about free usage.</p>
<p><img src="https://static.notion-static.com/cc011fef86b5453b971d1093fe036735/Untitled" alt=""></p>
<p>Let's keep the default settings of Instance Details and next. We use a 30 GB EBS since the free tier provides it:</p>
<p><img src="https://static.notion-static.com/7cf66fd77d624de4a78b2ccb47786d48/Untitled" alt=""></p>
<p>We don't need a tag yet, so leave it blank and next to configure Security Group. A security group is a set of firewall rules that control the traffic for the instance.</p>
<p>Here you need to add some rules:</p>
<ul>
<li>Allow SSH (TCP 22) traffic from your IP address</li>
<li>Allow all ICMP traffic from your IP address, to enable ping requests</li>
<li>Allow HTTPS and HTTP traffic (TCP 443 and 80)</li>
<li>Allow port 8000 for testing Mailman (TCP 8000)</li>
<li>Allow port 8024 for LMTP (TCP 8024)</li>
<li>Allow port 25 for SMTP (TCP 25)</li>
</ul>
<p>You can also give the new security group a fancy name, like &quot;Mailman-Security-Group&quot;. Then click &quot;Review and Launch&quot;.</p>
<p><img src="https://static.notion-static.com/4004c447f653413c8c27c74cd6ded8a1/Untitled" alt=""></p>
<p>In the Review page, you will see all the settings you have made before. Once you ensure they are ready, click &quot;Launch&quot; button. You will now be prompted of choosing your key pair. Still remember what we have done before? Choose that key, and Launch.</p>
<p><img src="https://static.notion-static.com/5debc8cc967d454a9b5a7db651f9c964/Untitled" alt=""></p>
<p>You can now view the instances and find your newly-created one after few-minute initialization.</p>
<h2>Allocate Elastic IP</h2>
<p>An Elastic IP address is a static IP address designed for dynamic cloud computing. An Elastic IP address is associated with your AWS account. With an Elastic IP address, you can mask the failure of an instance or software by rapidly remapping the address to another instance in your account. Read more about EIPs <a href="http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/elastic-ip-addresses-eip.html" target="_blank" rel="noopener">here</a> .</p>
<p>In short, we need to ensure our mailing list service has minimal downtime. Once the instance is down, we may switch to another instance if needed. To do that, first go back to the EC2 Dashboard, and then choose Network &amp; Security - Elastic IPs.</p>
<p><img src="https://static.notion-static.com/dc0f131dd4db4497865a25c687238ae9/Untitled" alt=""></p>
<p>CLick &quot;Allocate new address&quot; button, then &quot;Allocate&quot;. You will now have a new IP. Remember it as &lt;EIP&gt;.</p>
<p>Then go back to Elastic IPs page. Choose the one you just get, then click Actions - Associate address.</p>
<p><img src="https://static.notion-static.com/5946e9d77ae043c7952ae287a16d1939/Untitled" alt=""></p>
<p>Here you need to associate the new IP to the new EC2 instance.</p>
<p><img src="https://static.notion-static.com/508be3f14dc24ca79c8ea117938e3bf3/Untitled" alt=""></p>
<h2>Try to Connect to the Instance &amp; Update the System</h2>
<p>You now have your EC2 instance. Excited? Now let's connect to the instance via SSH.</p>
<p>The default username of the image we used (remember? Amazon Linux) is <code>ec2-user</code> , so we can connect using</p>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; ssh ec2-user@&lt;EIP&gt;</span><br></pre></td></tr></table></figure></p>
<p>You may be prompted to enter the password of your key. It is what you have set before. Forget the password? Go back to the most beginning of this article, and restart the works.</p>
<p>You are now in control of a fully working Linux server. Let's first update the system to ensure security.</p>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; sudo yum update -y</span><br></pre></td></tr></table></figure></p>
<p><img src="https://static.notion-static.com/66f1f55618bb430387771b8870be43bb/Untitled" alt=""></p>
<h1>Install Docker on the Instance</h1>
<p>The next step is to install Docker on your EC2 Instance. Go back to the SSH session we opened before, enter:</p>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; sudo yum install -y docker</span><br><span class="line">&gt; sudo service docker start</span><br></pre></td></tr></table></figure></p>
<p>Next, add the <code>ec2-user</code> to the <code>docker</code> group so you can execute Docker commands without using sudo:</p>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; sudo usermod -a -G docker ec2-user</span><br></pre></td></tr></table></figure></p>
<p>You need to log out and log back to make it take effect. Enter <code>exit</code> to log out then log back with <code>ssh</code> . If nothing goes wrong, type <code>docker info</code> and it will return information about the Docker installation.</p>
<p>Now we can test the Docker installation by running the <code>training/webapp</code> image:</p>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 80:5000 training/webapp:latest python [app.py](http://app.py)</span><br></pre></td></tr></table></figure></p>
<p>Copy the last line, which is the ID of the container. Try to visit http://&lt;EIP&gt;, you should see a page saying &quot;Hello World!&quot;. If so, congratulations, and we now need to stop the container by:</p>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker rm &lt;CONTAINER_ID&gt; -f</span><br></pre></td></tr></table></figure></p>
<p>After we have Docker ready, we need to install Docker Compose. Compose is a tool for defining and running multi-container Docker applications. With Compose, you use a YAML file to configure your application’s services. Follow the steps:</p>
<ol>
<li>Check the newest Compose release number in the <a href="https://github.com/docker/compose/releases" target="_blank" rel="noopener">Compose repository release page on GitHub</a> . Up to Nov. 24, 2017, it was 1.17.1.</li>
<li>Run this command to download the Docker Compose, replace <code>&lt;NEWEST_COMPOSE_RELEASE&gt;</code> with the version you get:</li>
</ol>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; sudo curl -L https://github.com/docker/compose/releases/download/&lt;NEWEST_COMPOSE_RELEASE&gt;/docker-compose-`uname -s`-`uname -m` -o /usr/<span class="built_in">local</span>/bin/docker-compose</span><br></pre></td></tr></table></figure></p>
<ol start="3">
<li>Add executable permissions to the binary:</li>
</ol>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; sudo chmod +x /usr/<span class="built_in">local</span>/bin/docker-compose</span><br></pre></td></tr></table></figure></p>
<ol start="4">
<li>Install command-line completion (Check here if you use zsh):</li>
</ol>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; sudo curl -L https://raw.githubusercontent.com/docker/compose/&lt;NEWEST_COMPOSE_RELEASE&gt;/contrib/completion/bash/docker-compose -o /etc/bash_completion.d/docker-compose</span><br><span class="line">&gt; <span class="built_in">source</span> ~/.bash_profile</span><br></pre></td></tr></table></figure></p>
<ol start="5">
<li>Test the installation:</li>
</ol>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; docker-compose --version</span><br><span class="line">docker-compose version 1.17.1, build 6d101fb</span><br></pre></td></tr></table></figure></p>
<h1>DNS Setting</h1>
<p>Now you have your instance, but before we head to the mailman part, let's bind a domain to the instance. The domain will be used as the address of mailman-web and the email address (the part after @).</p>
<p>Assuming we are using <a href="http://lists.example.com" target="_blank" rel="noopener">lists.example.com</a> as the domain, you should set a <code>A</code> DNS record of <code>lists.example.com</code> to the Elastic IP, then a <code>MX</code> record of <code>lists.example.com</code> , also to the Elastic IP.</p>
<h1>Configure Amazon SES</h1>
<p>Email is a complicated thing, especially when we are talking about delivery rate. It greatly depends on the reputation of your IP, your domain, and your contents. To ease a little burden, we will use Amazon SES here. Amazon SES, short for Amazon Simple Email Service, enables you to send and receive email using a reliable and scalable email platform.</p>
<h2>Verify Your Domain</h2>
<p>SES is also a region-based service (like EC2), but it is not available in Asia Pacific (Tokyo) yet, and therefore we choose US-East-1 (US East (N. Virginia)) as example here.</p>
<p>Let's navigate to the <a href="https://console.aws.amazon.com/ses/home?region=us-east-1" target="_blank" rel="noopener">SES Management Console</a> . Here you will see some introduction to SES, and a sidebar indicating all features you can use. But before we can send emails through SES, we need to verify our domain.</p>
<p>Click the &quot;Identity Management - Domains&quot;, and &quot;Verify a New Domain&quot; in the right panel. In the modal window, enter the domain you set before ( <code>lists.example.com</code> here), and remember to select &quot;Generate DKIM Settings&quot;.</p>
<p>What is DKIM? DomainKeys Identified Mail (DKIM) provides proof that the email you send originates from your domain and is authentic. It is a way to increase delivery rate.</p>
<p><img src="https://static.notion-static.com/52c570c65a2b4225b20cf13be0a08753/Untitled" alt=""></p>
<p>After you enter the domain, click &quot;Verify This Domain&quot;. A new modal window will show, with a bunch of DNS records you need to set. There is a &quot;Download Record Set as CSV&quot;, and you can download it since in the modal window the names and values. Then you should go to your DNS provider, set the required records (Note: only Domain Verification Record and DKIM Record Set, since we don't need SES to receive emails).</p>
<p><img src="https://static.notion-static.com/d1406bc4a3b34d2195c2c8bc84f08126/Untitled" alt=""></p>
<p>All DNS records shall look like this (Screenshot from Cloudflare):</p>
<p><img src="https://static.notion-static.com/581346be6802463190395c6754512a26/Untitled" alt=""></p>
<p>If you successfully set all records, the &quot;pending verification&quot; will become a green &quot;verified&quot;.</p>
<p><img src="https://static.notion-static.com/3b30869ea1cd4c2d9788500b945a7059/Untitled" alt=""></p>
<h2>Add a Verified Email Address</h2>
<p>Well, by default, all new accounts are in sandbox mode, which means you can only send emails to the email addresses that you have verified. Before we request a sending limit increase, we should fully test our system first. So, let's add a verified email address.</p>
<p>First go to &quot;Identity Management - Email Addresses&quot;. Here you will see a &quot;Verify a New Email Address&quot;. Yes, click it and enter your owned email address ( <code>test@example.com</code> here). Amazon will send a verification email and you need to open it and complete the verification process.</p>
<p><img src="https://static.notion-static.com/502d2e5eca9741ed85f613c5f3867fdf/Untitled" alt=""></p>
<p><img src="https://static.notion-static.com/f3d3eea5468e4ee1abd8d6674aacc3b1/Untitled" alt=""></p>
<h2>Obtain SMTP Credentials</h2>
<p>You need to obtain your SMTP user name and password in order to send email via mailman. The SMTP credentials are different from your AWS credentials. To obtain it, let's go back to the SES Management Console, and click the &quot;Email Sending - SMTP Settings&quot;. You will see some instruction on the right.</p>
<p><img src="https://static.notion-static.com/78e43b7cffbf4ad784370d1e49bee5a0/Untitled" alt=""></p>
<p>It shows the SMTP server name, port and TLS settings. Now click the &quot;Create My SMTP Credentials&quot;. YOu will be redirected to IAM Management Console, where you can create an IAM user for SMTP authentication with Amazon SES. Here a new username is predefined but you can use whatever you like. Let's make it <code>example-smtp</code> here. Then you will see this page:</p>
<p><img src="https://static.notion-static.com/bcae25d897ec4e47a91a347d565cbc64/Untitled" alt=""></p>
<p>As instructed, download the credentials which will be used later.</p>
<h1>Install Postfix &amp; Configure It</h1>
<p>Now let's go back to the SSH session (if your session was closed, just re-open one).</p>
<p>To use Postfix, you need to first remove sendmail and install postfix.</p>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; sudo yum remove sendmail -y</span><br><span class="line">&gt; sudo yum install postfix -y</span><br></pre></td></tr></table></figure></p>
<p>Then, edit the postfix main config file <code>/etc/postfix/main.cf</code> using any editor you like (for example, <code>nano</code> ). Add the following lines to the end of the file. Remember to replace email-smtp.us-west-1.amazonaws.com in the example above with the SMTP server name shown before.</p>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">relayhost = [email-smtp.us-east-1.amazonaws.com]:587</span><br><span class="line">smtp_sasl_auth_enable = yes</span><br><span class="line">smtp_sasl_security_options = noanonymous</span><br><span class="line">smtp_sasl_password_maps = <span class="built_in">hash</span>:/etc/postfix/sasl_passwd</span><br><span class="line">smtp_use_tls = yes</span><br><span class="line">smtp_tls_security_level = encrypt</span><br><span class="line">smtp_tls_note_starttls_offer = yes</span><br><span class="line">inet_protocols = ipv4</span><br></pre></td></tr></table></figure></p>
<p>Now, open the master.cf file.</p>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; sudo nano /etc/postfix/master.cf</span><br></pre></td></tr></table></figure></p>
<p>Locate the following line <code>-o smtp_fallback_relay=</code> and comment it (by placing a # (hash) character at the beginning). Save and close it.</p>
<p><img src="https://static.notion-static.com/8816265496144fbf942172d2342bc2dd/Untitled" alt=""></p>
<p>Still remember the SMTP credentials? It is now time to use it. Open (or create) a new file <code>/etc/postfix/sasl_passwd</code> .</p>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;sudo nano /etc/postfix/sasl_passwd</span><br></pre></td></tr></table></figure></p>
<p>Add the following line to the file. Replace the USERNAME and PASSWORD with the REAL information:</p>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[email-smtp.us-east-1.amazonaws.com]:587 USERNAME:PASSWORD</span><br></pre></td></tr></table></figure></p>
<p>Now create a hashmap database file containing the SMTP credentials by:</p>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; sudo postmap <span class="built_in">hash</span>:/etc/postfix/sasl_passwd</span><br></pre></td></tr></table></figure></p>
<p>The password files created are not encrypted, but you can use the system access control feature to restrict access:</p>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; sudo chown root:root /etc/postfix/sasl_passwd /etc/postfix/sasl_passwd.db</span><br><span class="line">&gt; sudo chmod 0600 /etc/postfix/sasl_passwd /etc/postfix/sasl_passwd.db</span><br></pre></td></tr></table></figure></p>
<p>Tell Postfix where to find the CA certificate (needed to verify the Amazon SES server certificate).</p>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; sudo postconf -e <span class="string">'smtp_tls_CAfile = /etc/ssl/certs/ca-bundle.crt'</span></span><br></pre></td></tr></table></figure></p>
<p>Restart the Postfix server:</p>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; sudo postfix stop; sudo postfix start</span><br></pre></td></tr></table></figure></p>
<p>Well, you have finished an important step! Now let's send a test email. Type the following line at the SSH session, remember to press Enter after each line, and replace From and recipient address with your real address (From address should be &lt;any&gt;@&lt;your_domain&gt; and recipient address ahould be your verified email address.</p>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt; sendmail -f sender@example.com recipient@example.com</span><br><span class="line">From: Sender Name &lt;sender@example.com&gt;</span><br><span class="line">Subject: Amazon SES Test</span><br><span class="line">This message was sent using Amazon SES.</span><br><span class="line">.</span><br></pre></td></tr></table></figure></p>
<p>Check the mailbox associated with the recipient address. If the email does not arrive, check your junk mail folder. If you still cannot locate the email, check your system's mail log (typically located at <code>/var/log/maillog</code> ) for more information.</p>
<h1>Getting Ready for Containers</h1>
<p>GNU Mailman 3 is actually a suite of softwares, including Mailman Core, Mailman Client, Postorius, and Hyperkitty. The normal installation is very complicated (I tried before. See my repo <a href="https://github.com/Yexiaoxing/mailman-on-aws" target="_blank" rel="noopener">here</a> ). But luckily, we can use Docker. Abhilash Raj maintains container images for Mailman 3, which you can use directly without having to go through all the steps to download dependencies and configuring Mailman.</p>
<p>To run the containers, we first need to clone the docker-mailman repo, which contains all docker compose files we need.</p>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; git <span class="built_in">clone</span> [https://github.com/maxking/docker-mailman](https://github.com/maxking/docker-mailman) &amp;&amp; <span class="built_in">cd</span> docker-mailman</span><br></pre></td></tr></table></figure></p>
<p>The default compose file do these things:</p>
<ul>
<li>Run a wsgi server using  <code>[uwsgi](https://uwsgi-docs.readthedocs.io/en/latest/)</code>  for the Mailman's Django based web frontend listening on  <a href="http://172.19.199.3:8000/" target="_blank" rel="noopener">http://172.19.199.3:8000/</a> . It will run 2 worker processes with 4 threads each.</li>
<li>Run a PostgreSQL server with a default database, username and password as mentioned in the  <code>docker-compose.yaml</code> .</li>
<li>Run mailman-core listening an LMTP server at  <a href="http://172.19.199.2:8024/" target="_blank" rel="noopener">http://172.19.199.2:8024/</a>  for messages from MTA.</li>
</ul>
<p>Before we can deploy the images, some common configuration should be set in <code>docker-compose.yaml</code> file.</p>
<h2>Mailman-Core</h2>
<p>These we need to change one variable:</p>
<ul>
<li><code>HYPERKITTY_API_KEY</code> : Hyperkitty's API Key, should be set to the same value as set for the mailman-core.</li>
</ul>
<p>The remaining three variables shall be keep default, if you are happy with PostgreSQL:</p>
<ul>
<li><code>DATABASE_URL</code> : URL of the database for the django to use. The standard docker-compose.yaml comes with it set to a postgres database, and to simplify we keep it default.</li>
<li><code>DATABASE_TYPE</code> and <code>DATABASE_CLASS</code> : The standard file is <code>postgres</code> , and we also keep it default.</li>
</ul>
<p>If you want to use a different DBMS, you need to change the three variables.</p>
<h2>Mailman-web</h2>
<p>These are the settings that you MUST change before deploying:</p>
<ul>
<li><code>SERVE_FROM_DOMAIN</code> : The domain name from which Django will be served. You should set it to the domain you are going to use, <code>lists.example.com</code> here.</li>
<li><code>HYPERKITTY_API_KEY</code> : Hyperkitty's API Key, should be set to the same value as set for the mailman-core.</li>
<li><code>MAILMAN_ADMIN_USER</code> : The username for the admin user to be created by default.</li>
<li><code>MAILMAN_ADMIN_EMAIL</code> : The email for the admin user to be created by default. Remember to use the verified email before.</li>
<li><code>SECRET_KEY</code> : Django's secret key, mainly used for signing cookies and others.</li>
</ul>
<h2>Sample docker-compose.yaml</h2>
<p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">'2'</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line"><span class="attr"> mailman-core:</span></span><br><span class="line"><span class="attr"> image:</span> <span class="string">maxking/mailman-core:0.1</span></span><br><span class="line"><span class="attr"> container_name:</span> <span class="string">mailman-core</span></span><br><span class="line"><span class="attr"> hostname:</span> <span class="string">mailman-core</span></span><br><span class="line"><span class="attr"> volumes:</span></span><br><span class="line"><span class="bullet"> -</span> <span class="string">/opt/mailman/core:/opt/mailman/</span></span><br><span class="line"><span class="attr"> stop_grace_period:</span> <span class="number">30</span><span class="string">s</span></span><br><span class="line"><span class="attr"> links:</span></span><br><span class="line"><span class="attr"> - database:</span><span class="string">database</span></span><br><span class="line"><span class="attr"> depends_on:</span></span><br><span class="line"><span class="bullet"> -</span> <span class="string">database</span></span><br><span class="line"><span class="attr"> environment:</span></span><br><span class="line"><span class="bullet"> -</span> <span class="string">DATABASE_URL=postgres://mailman:mailmanpass@database/mailmandb</span></span><br><span class="line"><span class="bullet"> -</span> <span class="string">DATABASE_TYPE=postgres</span></span><br><span class="line"><span class="bullet"> -</span> <span class="string">DATABASE_CLASS=mailman.database.postgresql.PostgreSQLDatabase</span></span><br><span class="line"><span class="bullet"> -</span> <span class="string">HYPERKITTY_API_KEY=3238348c-998e-4f59-b496-90cccc0b1126</span></span><br><span class="line"><span class="attr"> networks:</span></span><br><span class="line"><span class="attr"> mailman:</span></span><br><span class="line"><span class="attr"> ipv4_address:</span> <span class="number">172.19</span><span class="number">.199</span><span class="number">.2</span></span><br><span class="line"></span><br><span class="line"><span class="attr"> mailman-web:</span></span><br><span class="line"><span class="attr"> image:</span> <span class="string">maxking/mailman-web:0.1</span></span><br><span class="line"><span class="attr"> container_name:</span> <span class="string">mailman-web</span></span><br><span class="line"><span class="attr"> hostname:</span> <span class="string">mailman-web</span></span><br><span class="line"><span class="attr"> depends_on:</span></span><br><span class="line"><span class="bullet"> -</span> <span class="string">database</span></span><br><span class="line"><span class="attr"> links:</span></span><br><span class="line"><span class="attr"> - mailman-core:</span><span class="string">mailman-core</span></span><br><span class="line"><span class="attr"> - database:</span><span class="string">database</span></span><br><span class="line"><span class="attr"> volumes:</span></span><br><span class="line"><span class="bullet"> -</span> <span class="string">/opt/mailman/web:/opt/mailman-web-data</span></span><br><span class="line"><span class="attr"> environment:</span></span><br><span class="line"><span class="bullet"> -</span> <span class="string">DATABASE_TYPE=postgres</span></span><br><span class="line"><span class="bullet"> -</span> <span class="string">DATABASE_URL=postgres://mailman:mailmanpass@database/mailmandb</span></span><br><span class="line"><span class="bullet"> -</span> <span class="string">HYPERKITTY_API_KEY=3238348c-998e-4f59-b496-90cccc0b1126</span></span><br><span class="line"><span class="bullet"> -</span> <span class="string">SECRET_KEY=678df584-b7cb-4958-9f19-bd30f4190967</span></span><br><span class="line"><span class="bullet"> -</span> <span class="string">SERVE_FROM_DOMAIN=lists.example.com</span></span><br><span class="line"><span class="bullet"> -</span> <span class="string">MAILMAN_ADMIN_USER=lists</span></span><br><span class="line"><span class="bullet"> -</span> <span class="string">MAILMAN_ADMIN_EMAIL=lists@example.com</span></span><br><span class="line"><span class="attr"> networks:</span></span><br><span class="line"><span class="attr"> mailman:</span></span><br><span class="line"><span class="attr"> ipv4_address:</span> <span class="number">172.19</span><span class="number">.199</span><span class="number">.3</span></span><br><span class="line"></span><br><span class="line"><span class="attr"> database:</span></span><br><span class="line"><span class="attr"> environment:</span></span><br><span class="line"><span class="attr"> POSTGRES_DB:</span> <span class="string">mailmandb</span></span><br><span class="line"><span class="attr"> POSTGRES_USER:</span> <span class="string">mailman</span></span><br><span class="line"><span class="attr"> POSTGRES_PASSWORD:</span> <span class="string">mailmanpass</span></span><br><span class="line"><span class="attr"> restart:</span> <span class="string">always</span></span><br><span class="line"><span class="attr"> image:</span> <span class="attr">postgres:9.6-alpine</span></span><br><span class="line"><span class="attr"> volumes:</span></span><br><span class="line"><span class="bullet"> -</span> <span class="string">/opt/mailman/database:/var/lib/postgresql/data</span></span><br><span class="line"><span class="attr"> networks:</span></span><br><span class="line"><span class="attr"> mailman:</span></span><br><span class="line"><span class="attr"> ipv4_address:</span> <span class="number">172.19</span><span class="number">.199</span><span class="number">.4</span></span><br><span class="line"></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line"><span class="attr"> mailman:</span></span><br><span class="line"><span class="attr"> driver:</span> <span class="string">bridge</span></span><br><span class="line"><span class="attr"> ipam:</span></span><br><span class="line"><span class="attr"> driver:</span> <span class="string">default</span></span><br><span class="line"><span class="attr"> config:</span></span><br><span class="line"><span class="bullet"> -</span></span><br><span class="line"><span class="attr"> subnet:</span> <span class="number">172.19</span><span class="number">.199</span><span class="number">.0</span><span class="string">/24</span></span><br></pre></td></tr></table></figure></p>
<h2>Create Folders for Later Use</h2>
<p>Sometimes we need to do some extra configuration directly with the Mailman application.</p>
<p>There are two configuration files on the host that interact directly with Mailman's settings. These files exist on the host running the containers and are imported at runtime in the containers.</p>
<ul>
<li><code>/opt/mailman/core/mailman-extra.cfg</code>  : This is the configuration for Mailman Core and anything that you add here will be added to Core's configuration. You need to restart your mailman-core container for the changes in this file to take effect.</li>
<li><code>/opt/mailman/web/settings_local.py</code>  : This is the Django configuration that is imported by the  <a href="https://github.com/maxking/docker-mailman/blob/e551701580966b062f8f64ea09380c671fbffbfe/web/mailman-web/settings.py" target="_blank" rel="noopener">existing configuration</a>  provided by the mailman-web container. To change or override any settings in Django, you need to edit this file.</li>
</ul>
<p>To make it work, we need to create the folder:</p>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; sudo mkdir -p /opt/mailman/core</span><br><span class="line">&gt; sudo mkdir -p /opt/mailman/web</span><br></pre></td></tr></table></figure></p>
<h2>MTA Configuration</h2>
<p>Add the following settings to postfix's main config <code>/etc/postfix/main.cf</code> :</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># Support the default VERP delimiter.</span><br><span class="line">recipient_delimiter = +</span><br><span class="line">unknown_local_recipient_reject_code = 550</span><br><span class="line">owner_request_special = no</span><br><span class="line"></span><br><span class="line">transport_maps =</span><br><span class="line"> regexp:/opt/mailman/core/var/data/postfix_lmtp</span><br><span class="line">local_recipient_maps =</span><br><span class="line"> regexp:/opt/mailman/core/var/data/postfix_lmtp</span><br><span class="line">relay_domains =</span><br><span class="line"> regexp:/opt/mailman/core/var/data/postfix_domains</span><br></pre></td></tr></table></figure></p>
<p>Reload the Postfix by <code>sudo postfix reload</code> .</p>
<p>Then we need to configure Mailman to use Postfix. Add the following lines to /opt/mailman/core/mailman-extra.cfg:</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[mta]</span><br><span class="line">incoming: mailman.mta.postfix.LMTP</span><br><span class="line">outgoing: mailman.mta.deliver.deliver</span><br><span class="line">lmtp_host: 172.19.199.2</span><br><span class="line">lmtp_port: 8024</span><br><span class="line">smtp_host: 172.19.199.1</span><br><span class="line">smtp_port: 25</span><br><span class="line">configuration: /etc/postfix-mailman.cfg</span><br></pre></td></tr></table></figure></p>
<p>Finally, we need to set the default Email setting of mailman-web by creating a file named <code>/opt/mailman/web/settings_local.py</code> and fill:</p>
<p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">USE_SSL = <span class="keyword">False</span></span><br><span class="line">EMAIL_BACKEND = <span class="string">'django.core.mail.backends.smtp.EmailBackend'</span></span><br><span class="line">EMAIL_HOST = <span class="string">'172.19.199.1'</span></span><br><span class="line">EMAIL_PORT = <span class="number">25</span></span><br><span class="line">DEFAULT_FROM_EMAIL = <span class="string">"lists@&lt;your_domain&gt;"</span></span><br><span class="line">SERVER_EMAIL = <span class="string">"lists@&lt;your_domain&gt;"</span></span><br></pre></td></tr></table></figure></p>
<ul>
<li><code>DEFAULT_FROM_EMAIL</code> : This is the default address that used used as the FROM header in all the emails from your installation.</li>
<li><code>SERVER_EMAIL</code> : This is the address from which the errors emails will be sent to you.</li>
</ul>
<h1>Run the Docker Containers</h1>
<p>OK. You are now ready to run the containers. Go into the <code>docker-mailman</code> folder and run:</p>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; docker-compose up -d</span><br></pre></td></tr></table></figure></p>
<p>Docker will download all necessary images and run a container for you. What you need to do is to wait.</p>
<p>After the command runs, test if the service is running:</p>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; curl http://172.19.199.3:8000/postorius/lists/</span><br></pre></td></tr></table></figure></p>
<p>If you see a bunch of HTML elements, you are done with containers.</p>
<h1>Install Nginx &amp; Configure it</h1>
<p>It is advisable to run your Django (interfaced through WSGI server) through an actual web server in production for better performance. Here we use nginx, an HTTP and reverse proxy sever. It has been supporting many big sites such as Alibaba (which use a fork of nginx, called tengine).</p>
<h2>Install nginx</h2>
<p>One single command:</p>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; sudo yum install nginx-all-modules -y</span><br><span class="line">&gt; sudo service nginx start</span><br></pre></td></tr></table></figure></p>
<p>Then try to visit http://&lt;your_domain&gt;. you should see a <strong>Welcome to nginx on the Amazon Linux AMI!</strong> page.</p>
<p><img src="https://static.notion-static.com/c672f2dd45094abbbb2f3e3acb972c30/Untitled" alt=""></p>
<h2>Configure nginx</h2>
<p>Create a new file in <code>/etc/nginx/conf.d/</code> and name it with <code>&lt;your_domain&gt;.conf</code> .</p>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; sudo nano `/etc/nginx/conf.d/&lt;your_domain&gt;.conf`</span><br></pre></td></tr></table></figure></p>
<p>Fill in the following content:</p>
<p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line"></span><br><span class="line"> <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line"></span><br><span class="line"> <span class="attribute">server_name</span> `&lt;your_domain&gt;` ;</span><br><span class="line"> <span class="attribute">location</span> /static/ &#123;</span><br><span class="line"> <span class="attribute">alias</span> /opt/mailman/web/static/;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="attribute">location</span> / &#123;</span><br><span class="line"> <span class="attribute">include</span> uwsgi_params;</span><br><span class="line"> <span class="attribute">uwsgi_pass</span> <span class="number">172.19.199.3:8080</span>;</span><br><span class="line"> <span class="attribute">uwsgi_read_timeout</span> <span class="number">300</span>;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Then check if there is any error in config:</p>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; sudo nginx -t</span><br><span class="line">nginx: the configuration file /etc/nginx/nginx.conf syntax is ok</span><br><span class="line">nginx: configuration file /etc/nginx/nginx.conf <span class="built_in">test</span> is successful</span><br></pre></td></tr></table></figure></p>
<p>We can now restart the nginx process:</p>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; sudo service nginx restart</span><br></pre></td></tr></table></figure></p>
<p>Now you can test Mailman using http://&lt;your_domain&gt;.</p>
<p><img src="https://static.notion-static.com/cbc47b05bab94bdf8e260d4d6f16e55c/Untitled" alt=""></p>
<h1>Obtain Password for Default Admin Account</h1>
<p>We have set the default admin username and email, but wait — where is the password? We need to obtain it by resetting password. Go to the mailman-web, click Sign In, click Forget Password and then enter the email address. You will receive an email with the resetting link. Follow the link to set the password.</p>
<p>You can now enjoy the Mailman 3.</p>
<h1>Further Step on SSL</h1>
<p>There are actually some further steps you can perform, for example, enable SSL. We won't discuss it here, since you only need to do:</p>
<ol>
<li>Obtain a SSL cert (from letsencrypt maybe)</li>
<li>Configure nginx to use the SSL</li>
<li>Remove the <code>USE_SSL = False</code> line in <code>/opt/mailman/web/settings_local.py</code></li>
</ol>
<h1>References</h1>
<ol>
<li><a href="https://help.github.com/articles/generating-a-new-ssh-key-and-adding-it-to-the-ssh-agent/#platform-mac" target="_blank" rel="noopener">GitHub - Generating a new SSH key and adding it to the ssh-agent</a></li>
<li><a href="https://asynchronous.in/docker-mailman/" target="_blank" rel="noopener">GNU Mailman 3 Deployment with Docker</a></li>
<li><a href="https://www.ybrikman.com/writing/2015/11/11/running-docker-aws-ground-up/" target="_blank" rel="noopener">Running Docker on AWS from the ground up</a></li>
<li><a href="http://docs.aws.amazon.com/ses/latest/DeveloperGuide/postfix.html" target="_blank" rel="noopener">Integrating Amazon SES with Postfix - AWS Documentation</a></li>
<li><a href="https://github.com/Yexiaoxing/mailman-on-aws" target="_blank" rel="noopener">Way to deploy Mailman 3 on AWS (My Repo)</a></li>
</ol>

                    </div>
                </div>
                

<div class="license-notice">
    <span>Author: </span>Xiaoxing Ye<br>
    <span>Posted at: </span>2017-11-24<br>
    <span>Updated at: </span>2017-11-26<br>
    <span>Licensed under: </span>
    
    <a href="https://creativecommons.org/licenses/by-sa/4.0" target="_blank">
    
    BY-SA
    
    </a>
    
</div>

                <nav class="post-tags">
                
                    
                    <a href="/tags/Tutorials/" title="Tutorials" rel="tag" class="fa fa-tag">Tutorials</a>
                    
                    <a href="/tags/docker/" title="docker" rel="tag" class="fa fa-tag">docker</a>
                    
                    <a href="/tags/mailman/" title="mailman" rel="tag" class="fa fa-tag">mailman</a>
                    
                    <a href="/tags/aws/" title="aws" rel="tag" class="fa fa-tag">aws</a>
                    
                
                </nav>
            </article>
        </div><!-- div#primary -->
        <ul id="pager">

    
    <li class="next">
        <a href="/2017/11/19/From-0-to-1-Build-Your-Blog-using-Hexo/" title="From 0 to 1: Build Your Blog Using Hexo" class="tooltipped tooltipped-n" aria-label="From 0 to 1: Build Your Blog Using Hexo">Next post <span class="fa fa-chevron-right"></span></a>
    </li>
    
</ul>

        
<section id="comments">
    
</section>


        
    </div>
</main>

    <!-- Footer -->
    
<!-- #content -->
<footer id="footer">
    <div class="container">
        <p>
            <span class="cc-license">
                <a href="https://creativecommons.org/licenses/by-sa/4.0" target="_blank" title="Creative Commons license by-sa">
                <span class="cc cc-cc"></span>
                
                    <span class="cc cc-by"></span>
                
                    <span class="cc cc-sa"></span>
                
                </a>
            </span>
            &nbsp;2017-2017 Xiaoxing Ye&#39;s Farmland.
        </p>
        <p>Themed by <a href="https://github.com/unnamed42/hexo-theme-kunkka">Kunkka</a> | Powered by <a href="https://hexo.io/">Hexo</a>.</p>
        


<div class="sns-icons">
    
        
        
    
        
        
    
        
        
    
        
        
    
        
        
    
        
        
    
        
        
    
        
        
    
        
        
    
</div>


    </div>
</footer>
<!-- #footer -->

    <div id="totop" title="Back to top">
    <canvas id="totop-canvas" width="48" height="48"></canvas>
    <div id="totop-percent"></div>
</div><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config("");
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/mathjax@2.7.2/MathJax.js">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->

</body>

</html>
